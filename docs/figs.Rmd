---
title: Figures for "Sources and consequences of mismatch between leaf disc and whole-leaf leaf mass per area (LMA)"
author: Masatoshi Katabuchi
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
      fig_caption: yes
      theme: spacelab #readable #sandstone #spacelab #flatly
      highlight: pygments #tango #kate
      toc: TRUE
      toc_depth: 2
      number_sections: TRUE
      toc_float:
        collapsed: TRUE
        smooth_scroll: TRUE
        toc: true
---

```{r, echo = F}
rm(list = ls())
```

```{r global_options, include=FALSE}
library(knitr)
basename <- "ms-leaf-disc"
opts_chunk$set(fig.path = paste0("components/figure/", basename, "-"),
               cache.path = paste0("components/cache/", basename, "/"))
knitr::opts_chunk$set(echo=TRUE,
                      cache=TRUE,
                      warning=FALSE,
                      message=FALSE)
```


# Library

```{r, cache=FALSE}
library(tidyverse)
library(tictoc)
library(patchwork)
library(smatr)
library(ggpubr)
library(ggsma)
library(kableExtra)
source("../scripts/util.R")
```

```{r, cache=FALSE}
theme_set(theme_bw())
theme_update(text = element_text(family = "Arial"))
```

# Datasets

```{r}
d <- read_csv("../data/full_data.csv")
d_cv <- read_csv("../data/full_data_cv.csv")

d <- d |>
  filter(!is.na(LMAdisc)) |>
  filter(!is.na(LMAleaf)) |>
  filter(!is.na(LTleaf)) |>
  rename(LT = LTleaf) |>
  rename(LA = LAleaf) |>
  filter(Location %in% c("Ailao_understory", "Mengla_Bubeng", "Yuanjiang_Savanna", "Yakushima")) |>
  #filter(Location != "Yakushima") |>
  mutate(LMAratio = LMAleaf / LMAdisc) |>
  mutate(LDratio = LDleaf / LDdisc)

LA1 <- quantile(d$LA, 0.25, na.rm = TRUE)
LA2 <- quantile(d$LA, 0.5, na.rm = TRUE)
LA3 <- quantile(d$LA, 0.75, na.rm = TRUE)
LT1 <- quantile(d$LT, 0.25, na.rm = TRUE)
LT2 <- quantile(d$LT, 0.5, na.rm = TRUE)
LT3 <- quantile(d$LT, 0.75, na.rm = TRUE)

LA_mid <- median(d$LA)
LT_mid <- median(d$LT, na.rm = TRUE)

d <- d |>
  mutate(LT_gr = case_when(
    LT < LT1 ~ "Very~thin",
    LT < LT2 ~ "Thin",
    LT < LT3 ~ "Thick",
    TRUE ~ "Very~thick")) |>
  mutate(LT_gr = factor(LT_gr, levels = c("Very~thin", "Thin", "Thick",
                                          "Very~thick"))) |>
  mutate(LA_gr = case_when(
    LA < LA1 ~ "Very~small",
    LA < LA2 ~ "Small",
    LA < LA3 ~ "Large",
    TRUE ~ "Very~large")) |>
  mutate(LA_gr = factor(LA_gr, levels = c("Very~small", "Small", "Large",
                                          "Very~large"))) |>
  mutate(LALT_gr = case_when(
   LA < LA_mid & LT < LT_mid ~ "Thin~Small",
   LA < LA_mid & LT >= LT_mid ~ "Thick~Small",
   LA >= LA_mid & LT < LT_mid ~ "Thin~Large",
   LA >= LA_mid & LT >= LT_mid ~ "Thick~Large",
   TRUE ~ "aa"
                          )) |>
  mutate(LA_gr2 = ifelse(LA < LA_mid, "Small-leaved~species",
                         "Large-leaved~species")) |>
  mutate(LT_gr2 = ifelse(LT < LT_mid, "Thin-leaved~species",
                         "Thick-leaved~species"))

d_cv <- d_cv |>
  dplyr::select(Species, Location,
                LMAleaf_cv = LMAleaf, LMAdisc_cv = LMAdisc,
                LDleaf_cv = LDleaf, LDdisc_cv = LDdisc) |>
  #full_join(d) |>
  filter(!is.na(LMAleaf_cv)) |>
  filter(!is.na(LMAdisc_cv))


d_cv2 <- d_cv |>
  full_join(d) |>
  filter(!is.na(LMAleaf_cv)) |>
  filter(!is.na(LMAdisc_cv))

d %>%
  head %>%
  kable() %>%
  kable_styling()
```


# Leaf disc vs whole-leaf LMA (species-level)

## Pooled

```{r LMA-gr2}
p_LALT_grid <- d |>
  ggplot(aes(x = LMAdisc, y = LMAleaf)) +
  geom_point(alpha = 0.8) +
  scale_x_log10() +
  scale_y_log10() +
  geom_abline(slope = 1, intercept = 0, lty = 2) +
  geom_sma(se = TRUE) +
  facet_grid(LA_gr2~LT_gr2, scale = "free", labeller = label_parsed) +
  #facet_wrap(~LALT_gr, scale = "fixed", labeller = label_parsed) +
  xlab(expression(Leaf~disc~LMA~(g~m^{-2}))) +
  ylab(expression(Whole-leaf~LMA~(g~m^{-2}))) +
  stat_cor(
    aes(label = paste(..rr.label.., ..n.label.., sep = "~`,`~"), family = "Arial")
  )

ggsave("../figs/LMA_sp_gr.png", p_LALT_grid, width = 6, height = 6)
```

![](../figs/LMA_sp_gr.png)


## Separated

```{r LMA-gr-both}
my_col <- RColorBrewer::brewer.pal(4, "RdBu")

p_LALT_grid_both <- d |>
  mutate(punch_size = ifelse(Location == "Yakushima", "1.0 cm", "0.6 cm")) |>
  ggplot(aes(x = LMAdisc, y = LMAleaf, col = punch_size)) +
  geom_point(alpha = 0.6) +
  scale_x_log10() +
  scale_y_log10() +
  geom_abline(slope = 1, intercept = 0, lty = 2) +
  geom_sma(se = FALSE) +
  scale_color_manual(values = my_col[c(2, 4)],
                     name = "Diameter of the leaf punch") +
  facet_grid(LA_gr2~LT_gr2, scale = "free", labeller = label_parsed) +
  #facet_wrap(~LALT_gr, scale = "fixed", labeller = label_parsed) +
  xlab(expression(Leaf~disc~LMA~(g~m^{-2}))) +
  ylab(expression(Whole-leaf~LMA~(g~m^{-2}))) +
  stat_cor(
    aes(label = paste(..rr.label.., ..n.label.., sep = "~`,`~"), family = "Arial"),
    show.legend = FALSE
  ) +
 theme(legend.position = c(0.3, 0.1),
        legend.key.size = unit(0.5, "cm"),
        legend.spacing.y = unit(0.1, "cm"),
        legend.text.align = 0,
        legend.key.height = unit(0.2, "cm"),
        legend.text = element_text(size = 9),
        legend.title = element_text(size = 9)
 )

ggsave("../figs/LMA_sp_gr_both.png", p_LALT_grid_both, width = 6, height = 6)
```

![](../figs/LMA_sp_gr_both.png)

# SMA table (species-level)

```{r sma}

sma_LMA <- sma(log10(LMAleaf) ~ log10(LMAdisc),
    data = d,
    elev.test = 0,
    slope.test = 1)

sma_LD <- sma(log10(LDleaf) ~ log10(LDdisc),
    data = d,
    elev.test = 0,
    slope.test = 1)

sma_LMA_LALT_gr <- sma(log10(LMAleaf) ~ log10(LMAdisc) * LALT_gr,
    data = d,
    elev.test = 0,
    slope.test = 1)

sma_LD_LALT_gr <- sma(log10(LDleaf) ~ log10(LDdisc) * LALT_gr,
    data = d,
    elev.test = 0,
    slope.test = 1)

my_fun <- function(fit) {
  tb1 <- fit$groupsummary |>
    mutate(Slope = paste0(round(Slope, 2), " [", round(Slope_lowCI, 2), ", ",
                          round(Slope_highCI, 2), "]"))|>
    mutate(Intecept = paste0(round(Int, 2), " [", round(Int_lowCI, 2), ", ",
                          round(Int_highCI, 2), "]"))|>
    mutate(sig_slope = case_when(
                             Slope_highCI < 1 ~ "sig",
                             Slope_lowCI > 1 ~ "sig",
                             TRUE ~ "ns"
                             )) |>
    mutate(sig_int = ifelse(Int_lowCI * Int_highCI > 0, "sig", "ns")) |>
    mutate(r2 = round(r2, 2)) |>
    dplyr::select(Slope, Intecept, r2, sig_slope, sig_int, group)
  tb2 <- tb1 |>
    mutate(Slope = ifelse(sig_slope == "sig", paste0("**", Slope, "**"), Slope)) |>
    mutate(Intecept = ifelse(sig_int == "sig", paste0("**", Intecept, "**"),
                             Intecept)) |>
    dplyr::select(Slope, Intecept, `*R^2^*` = r2)
  list(tb1, tb2, group = tb1$group)
}


tb0_LMA <- my_fun(sma_LMA)
tb0_LD <- my_fun(sma_LD)
tb2_LMA <- my_fun(sma_LMA_LALT_gr)
tb2_LD <- my_fun(sma_LD_LALT_gr)

#tb_dat <- rbind(cbind(tb0_LMA[[2]], tb0_LD[[2]]),
#  cbind(tb2_LMA[[2]], tb2_LD[[2]]))

tb_dat <- rbind(tb0_LMA[[2]], tb2_LMA[[2]])
tb_dat <- cbind(c("All", tb2_LMA$group), tb_dat) |>
  as.data.frame()

tb_dat %>%
  write_csv("../data/tab1.csv")

colnames(tb_dat)[1] <- "Data"
rownames(tb_dat) <- NULL

tb_dat |>
  kable() |>
 #pack_rows("all", 1, 1) |>
 #pack_rows("Site", 2, 6) |>
 #add_header_above(c(" ", "LMA" = 3, "LD" = 3)) |>
  kable_styling()

```

# Leaf disc vs whole-leaf LMA (individual-level)

```{r LMA-ind}
tree <- read_csv("../data/tree_data.csv")

tree <- tree |>
  filter(!is.na(LMAdisc)) |>
  filter(!is.na(LMAleaf)) |>
  filter(!is.na(LTleaf)) |>
  rename(LT = LTleaf) |>
  rename(LA = LAleaf) |>
  mutate(Dry_mass_disc2 = case_when(
   Location == "Yakushima" ~ LMAdisc * 1.57 * 10^-4 / 2,
   TRUE ~ LMAdisc * 0.889 * 10^-4 / 3
                )) |>
  mutate(Dry_mass_disc = case_when(
   Location == "Yakushima" ~ LMAdisc * 1.57 * 10^-4,
   TRUE ~ LMAdisc * 0.889 * 10^-4
                ))

LA1_tree <- quantile(tree$LA, 0.25, na.rm = TRUE)
LA2_tree <- quantile(tree$LA, 0.5, na.rm = TRUE)
LA3_tree <- quantile(tree$LA, 0.75, na.rm = TRUE)
LT1_tree <- quantile(tree$LT, 0.25, na.rm = TRUE)
LT2_tree <- quantile(tree$LT, 0.5, na.rm = TRUE)
LT3_tree <- quantile(tree$LT, 0.75, na.rm = TRUE)

LA_mid_tree <- median(tree$LA, na.rm = TRUE)
LT_mid_tree <- median(tree$LT, na.rm = TRUE)

tree <- tree |>
  mutate(LT_gr = case_when(
    LT < LT1_tree ~ "Very~thin",
    LT < LT2_tree ~ "Thin",
    LT < LT3_tree ~ "Thick",
    TRUE ~ "Very~thick")) |>
  mutate(LT_gr = factor(LT_gr, levels = c("Very~thin", "Thin", "Thick",
                                          "Very~thick"))) |>
  mutate(LA_gr = case_when(
    LA < LA1_tree ~ "Very~small",
    LA < LA2_tree ~ "Small",
    LA < LA3_tree ~ "Large",
    TRUE ~ "Very~large")) |>
  mutate(LA_gr = factor(LA_gr, levels = c("Very~small", "Small", "Large",
                                          "Very~large"))) |>
  mutate(LALT_gr = case_when(
   LA < LA_mid_tree & LT < LT_mid_tree ~ "Thin~Small",
   LA < LA_mid_tree & LT >= LT_mid_tree ~ "Thick~Small",
   LA >= LA_mid_tree & LT < LT_mid_tree ~ "Thin~Large",
   LA >= LA_mid_tree & LT >= LT_mid_tree ~ "Thick~Large",
   TRUE ~ "aa"
                          )) |>
  mutate(LA_gr2 = ifelse(LA < LA_mid_tree, "Small-leaved~individuals",
                         "Large-leaved~individuals")) |>
  mutate(LT_gr2 = ifelse(LT < LT_mid_tree, "Thin-leaved~individuals",
                         "Thick-leaved~individuals"))

```

```{r LMA-gr2-ITV}
p_LALT_tree <- tree |>
  ggplot(aes(x = LMAdisc, y = LMAleaf, col = Dry_mass_disc)) +
  geom_point(alpha = 0.8) +
  scale_color_viridis_c(trans = "log10",
                        name = "Total dry mass of \nleaf discs (g)") +
  scale_x_log10() +
  scale_y_log10() +
  geom_abline(slope = 1, intercept = 0, lty = 2) +
  geom_sma(se = TRUE) +
  facet_grid(LA_gr2~LT_gr2, scale = "free", labeller = label_parsed) +
  xlab(expression(Leaf~disc~LMA~(g~m^{-2}))) +
  ylab(expression(Whole-leaf~LMA~(g~m^{-2}))) +
  stat_cor(
    aes(label = paste(..rr.label.., ..n.label.., sep = "~`,`~"), family = "Arial")
  ) +
  theme(legend.position = c(0.39, 0.15),
        legend.key.size = unit(0.5, "cm"),
        legend.spacing.y = unit(0.1, "cm"),
        legend.text.align = 0,
        legend.key.height = unit(0.3, "cm"),
        legend.text = element_text(size=7),
        legend.title = element_text(size=7))

ggsave("../figs/LMA_ind_gr.png", p_LALT_tree, width = 6, height = 6)
```

![](../figs/LMA_ind_gr.png)

# Divergence (species-level) 

```{r LMAratio}
my_col <- RColorBrewer::brewer.pal(4, "RdBu")

LMAratio <- tree |>
  mutate(punch_size = ifelse(Location == "Yakushima", "1.0 cm", "0.6 cm")) |>
  ggplot(aes(Dry_mass_disc, LMAleaf / LMAdisc,
             col = punch_size
             )) +
  geom_point(alpha = 0.6) +
  geom_hline(yintercept = 1) +
  scale_color_manual(values = my_col[c(2, 4)],
                     name = "Diameter of the leaf punch") +
  xlab("Total dry mass of leaf disc (g)") +
  ylab("Whole-leaf LMA / leaf disc LMA") +
  theme(
        legend.position = c(0.7, 0.75),
        legend.key.size = unit(0.5, "cm"),
        legend.spacing.y = unit(0.1, "cm"),
        legend.text.align = 0,
        legend.key.height = unit(0.3, "cm"),
        legend.text = element_text(size=7),
        legend.title = element_text(size=7))

LMAratio_LT <- tree |>
  mutate(punch_size = ifelse(Location == "Yakushima", "1.0 cm", "0.6 cm")) |>
  ggplot(aes(LT, LMAleaf / LMAdisc,
            col = Dry_mass_disc
             )) +
  geom_point(alpha = 0.6) +
  geom_hline(yintercept = 1) +
  scale_color_viridis_c(trans = "log10",
                        name = "Total leaf disc \ndry mass (g)") +
  #scale_color_viridis_d() +
  scale_x_log10() +
  xlab("Leaf thickness (mm)") +
  ylab("Whole-leaf LMA / leaf disc LMA") +
  theme(
        legend.position = c(0.7, 0.75),
        legend.key.size = unit(0.5, "cm"),
        legend.spacing.y = unit(0.1, "cm"),
        legend.text.align = 0,
        legend.key.height = unit(0.3, "cm"),
        legend.text = element_text(size=7),
        legend.title = element_text(size=7))

LMAratio_LA <- tree |>
  mutate(punch_size = ifelse(Location == "Yakushima", "1.0 cm", "0.6 cm")) |>
  ggplot(aes(LA, LMAleaf / LMAdisc,
            col = Dry_mass_disc
             )) +
  geom_point(alpha = 0.6) +
  geom_hline(yintercept = 1) +
  scale_color_viridis_c(trans = "log10",
                        name = "Total leaf disc \ndry mass (g)") +
  #scale_color_viridis_d() +
  scale_x_log10() +
  xlab(expression(Leaf~area~(m^2))) +
  ylab("Whole-leaf LMA / leaf disc LMA") +
  theme(
        legend.position = "none",
        #legend.position = c(0.2, 0.75),
        legend.key.size = unit(0.5, "cm"),
        legend.spacing.y = unit(0.1, "cm"),
        legend.text.align = 0,
        legend.key.height = unit(0.3, "cm"),
        legend.text = element_text(size=7),
        legend.title = element_text(size=7))

p_ratio <- LMAratio + LMAratio_LT + LMAratio_LA +
  plot_annotation(tag_levels = "a")


ggsave("../figs/LMAratio2.png", p_ratio, width = 9, height = 3)
```

![](../figs/LMAratio2.png)

Check for heteroscedasticity.

```{r}
#LMAratio
lmtest::bptest(lm(log(LMAleaf / LMAdisc) ~ log(Dry_mass_disc), tree))
lmtest::bptest(lm(log(LMAleaf / LMAdisc) ~ (Dry_mass_disc), tree))
lmtest::bptest(lm(log(LMAleaf / LMAdisc) ~ log(LT), tree))
lmtest::bptest(lm(log(LMAleaf / LMAdisc) ~ log(LA), tree))
```

# LMA and LD (species-level)

```{r LMA-LD}
d_leaf <- d |>
  dplyr::select(c(Species:Contributor, LMA = LMAleaf, LDMC = LDMCleaf, LD = LDleaf)) |>
  pivot_longer(LMA:LD, names_to = "trait", values_to = "Whole-leaf") |>
  filter(Location != "Yakushima" | trait != "LD") |>
  filter(Location != "Yakushima" | trait != "LMA")

d_disc <- d |>
  dplyr::select(Species, Location, LMA = LMAdisc, LDMC = LDMCdisc, LD = LDdisc) |>
  pivot_longer(LMA:LD, names_to = "trait", values_to = "Leaf Disc") |>
  filter(Location != "Yakushima" | trait != "LD") |>
  filter(Location != "Yakushima" | trait != "LMA")

d2 <- full_join(d_leaf, d_disc) |>
  mutate(trait = factor(trait, c("LMA", "LDMC", "LD"))) |>
  mutate(trait_lab = factor(trait,
                            labels = c("LMA~(g~m^{-2})",
                                       "LDMC~(g~g^{-1})",
                                       "LD~(g~cm^{-3})"
                            )))


p_all <- d2 |>
  filter(trait != "LDMC") |>
  ggplot(aes(x = `Leaf Disc`, y = `Whole-leaf`)) +
  geom_abline(intercept = 0, slope = 1, lty = 2) +
  geom_point(alpha = 0.6) +
  scale_x_log10() +
  scale_y_log10() +
#  geom_smooth(method = "lm", se = FALSE) +
  geom_sma(se = TRUE) +
  facet_wrap(~trait_lab, scale = "free", labeller = label_parsed) +
  stat_cor(
    #aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~"))
    aes(label = paste(..rr.label..,  ..n.label.., sep = "~`,`~"), family = "Arial")
 #   label.x = 2
  )


ggsave("../figs/fig1.png", p_all, width = 6, height = 3)
```

![](../figs/fig1.png)



# CV

```{r cv}
p_cv1 <- d_cv |>
  ggplot(aes(x = LMAdisc_cv, y = LMAleaf_cv)) +
  geom_abline(intercept = 0, slope = 1, lty = 2) +
  geom_point(alpha = 0.6) +
  scale_x_continuous(trans = "sqrt", breaks = c(0.001, 0.01, 0.05, 0.1)) +
  scale_y_continuous(trans = "sqrt", breaks = c(0.001, 0.01, 0.05, 0.1)) +
  geom_sma(se = TRUE) +
  ylab("CV of whole-leaf LMA") +
  xlab("CV of leaf disc LMA") +
  coord_fixed() +
  stat_cor(
           label.x.npc = 0.3,
           label.y.npc = 0,
           vjust = 1.5,
           aes(label = paste(..rr.label..,  ..n.label.., sep = "~`,`~"), family = "Arial")
               )

p_cv2 <- d_cv |>
  filter(Location != "Yakushima") |>
  ggplot(aes(x = LMAdisc_cv, y = LMAleaf_cv)) +
  geom_abline(intercept = 0, slope = 1, lty = 2) +
  geom_point(alpha = 0.6) +
  scale_x_continuous(trans = "sqrt") +
  scale_y_continuous(trans = "sqrt") +
  geom_sma(se = TRUE) +
  ggtitle("Diameter: 0.6 cm") +
  ylab("CV of whole-leaf LMA") +
  xlab("CV of leaf disc LMA") +
  #coord_fixed(xlim = c(0.01, 5.4), ylim = c(0.01, 5.4)) +
  #coord_fixed() +
  stat_cor(
    aes(label = paste(..rr.label..,  ..n.label.., sep = "~`,`~"), family = "Arial")
  )

p_cv3 <- d_cv |>
  filter(Location == "Yakushima") |>
  ggplot(aes(x = LMAdisc_cv, y = LMAleaf_cv)) +
  geom_abline(intercept = 0, slope = 1, lty = 2) +
  geom_point(alpha = 0.6) +
  scale_x_continuous(trans = "sqrt") +
  scale_y_continuous(trans = "sqrt") +
  geom_sma(se = TRUE) +
  ggtitle("Diameter: 1.0 cm") +
  ylab("CV of whole-leaf LMA") +
  xlab("CV of leaf disc LMA") +
  #coord_fixed(xlim = c(0.01, 5.4), ylim = c(0.01, 5.4)) +
  #coord_fixed() +
  stat_cor(
    aes(label = paste(..rr.label..,  ..n.label.., sep = "~`,`~"), family = "Arial")
  )

p_cv <- (p_cv2 + p_cv3) +
  plot_annotation(tag_levels = "a")

ggsave("../figs/fig_cv2.png", p_cv, width = 6, height = 3)

ggsave("../figs/fig_cv.png", p_cv1, width = 3, height = 3)

```

## Pooled

![](../figs/fig_cv.png)


## Separated

![](../figs/fig_cv2.png)


# Leaf support cost (species-level)

```{r petiole}
d3 <- read_csv("../data-raw/leaf_traits_for_Katabuchi.csv")

yaku <- d3 |>
  filter(Growthform != "H") |>
  mutate(Location = "Yakushima") |>
  mutate(Biomes = "ST2") |>
  mutate(Garden = "NO") |>
  mutate(MAT = NA) |>
  mutate(MAP = NA) |>
  mutate(Contributor = "Onoda Yusuke") |>
  rename(
                LA = `LA mean (leaf let)`,
                LT = `Lamina thickness`,
                LMAdisc = `LD LMA`,
                LMAleaf = `Whole leaf LMA`,
                LDMCleaf = `LDMC`,
                LDdisc = `TD`
  ) |>
  mutate(LDleaf = LMAleaf / LT * 10^-3) %>%
  mutate(LDMCdisc = NA) |>
  mutate(LTdisc = NA) |>
  mutate(Growthform = ifelse(Growthform == "W", "Trees", Growthform)) |>
  mutate(petiole_ratio = `petiole DW`/`Scanned leaf DW`)

yaku_sp <- yaku |>
  group_by(Species) |>
  summarize_at(
               .vars = vars(
             LMAdisc,
             LMAleaf,
             LDMCdisc,
             LDMCleaf,
             LDdisc,
             LDleaf,
             LT,
             LTdisc,
             LA,
             petiole_ratio
               ),
    .funs =  \(x)mean(x, na.rm = TRUE)) |>
  filter(petiole_ratio > 0) |>
  filter(!is.na(LMAdisc))

pet1 <- ggplot(yaku_sp, aes(x = petiole_ratio, y = LMAleaf/LMAdisc)) +
  geom_point() +
  scale_x_log10() +
  #xlab(expression(Petiole/leaf~dry~mass~ratio(g~g^-1))) +
  xlab("Petiole / leaf dry mass ratio") +
  ylab("Whole-leaf / leaf disc LMA ratio") +
  geom_smooth(method = "lm") +
  stat_cor(
    aes(label = paste(..rr.label.., ..n.label.., sep = "~`,`~"), family = "Arial")
  )

pet2 <- ggplot(yaku_sp, aes(x = petiole_ratio, y = LA)) +
  geom_point() +
  scale_x_log10() +
  scale_y_log10() +
  xlab("Petiole / leaf dry mass ratio") +
  ylab(expression(Leaf~area~(g~cm^2))) +
  geom_smooth(method = "lm") +
  stat_cor(
    aes(label = paste(..rr.label.., ..n.label.., sep = "~`,`~"), family = "Arial")
  )

pet3 <- pet2 + pet1 +
  plot_annotation(tag_levels = "a") &
  theme(plot.tag = element_text(face = "bold"))

ggsave("../figs/petiole.png", pet3, width = 8, height = 4)

```

![](../figs/petiole.png)


# Computing Environment

```{r}
devtools::session_info()
```

